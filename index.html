<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANAN</title>
    <style>
        /* FONT IMPORT - DÉ™yiÅŸiklik yoxdur */
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Changa+One:ital@0;1&family=Varela+Round&display=swap');
        
        /* GLOBAL STYLES - DÉ™yiÅŸiklik yoxdur */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #FFC107, #FF9800, #FFC107);
            font-family: 'Varela Round', sans-serif;
            color: #333;
            padding: 10px;
            overflow-x: hidden; /* X ekseni daÅŸqÄ±nÄ±nÄ± aradan qaldÄ±rÄ±r */
            box-sizing: border-box; /* BÃ¼tÃ¼n elementlÉ™r Ã¼Ã§Ã¼n É™lavÉ™ edildi */
        }

        /* ANA KONTEYNER - Mobil Ã¼Ã§Ã¼n flex-wrap É™lavÉ™ edildi */
        #ana-konteyner {
            display: flex;
            flex-wrap: wrap; /* Æsas DÉ™yiÅŸiklik: MobildÉ™ alt-alta dÃ¼ÅŸmÉ™si Ã¼Ã§Ã¼n */
            justify-content: center;
            align-items: flex-start; /* Kontent yuxarÄ±dan baÅŸlasÄ±n */
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 10px;
            box-sizing: border-box;
        }

        /* OYUN KONTEYNERÄ° - GeniÅŸlik optimallaÅŸdÄ±rÄ±ldÄ± */
        #oyun-konteyner {
            flex-shrink: 0;
            width: 650px; /* Desktop Ã¼Ã§Ã¼n É™sas geniÅŸlik */
            max-width: 95%; /* MobildÉ™ ekranÄ± doldurmasÄ± Ã¼Ã§Ã¼n */
            text-align: center;
            padding: 25px;
            background-color: #FFFDE7;
            border-radius: 35px;
            border: 10px solid #8BC34A;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 50px rgba(139, 195, 74, 0.5);
            position: relative;
            transition: all 0.3s ease-in-out;
            z-index: 1;
            box-sizing: border-box;
        }
        
        #oyun-konteyner:hover {
            transform: translateY(-5px) scale(1.0);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6), 0 0 70px rgba(139, 195, 74, 0.7);
        }

        /* OYUN SAHÆSÄ° (CANVAS) - DÉ™yiÅŸiklik yoxdur, JS ilÉ™ Ã¶lÃ§Ã¼ tÉ™nzimlÉ™nÉ™cÉ™k */
        #oyun-sahÉ™si {
            border: 6px dashed #FF9800;
            background-color: #E0F2F7;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewport="0 0 100 100" style="fill:black;font-size:20px;"><text y="50%">ğŸ‘†</text></svg>') 17 17, auto; 
            display: block;
            margin: 15px auto 15px;
            border-radius: 20px;
            touch-action: manipulation; 
            width: 100%; /* Æsas DÉ™yiÅŸiklik: Konteynerin Ã¶lÃ§Ã¼sÃ¼nÉ™ uyÄŸun olsun */
            height: 400px; /* HÉ™lÉ™lik sabit qalsÄ±n, JS-dÉ™ tÉ™nzimlÉ™nÉ™ bilÉ™r */
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
            opacity: 0.3;
        }
        
        /* SIRALAMA KONTEYNERÄ° - GeniÅŸlik vÉ™ margin optimallaÅŸdÄ±rÄ±ldÄ± */
        #sÄ±ralama-konteyner {
            flex-shrink: 0;
            width: 250px; /* Desktop Ã¼Ã§Ã¼n É™sas geniÅŸlik */
            max-width: 95%; /* MobildÉ™ ekranÄ± doldurmasÄ± Ã¼Ã§Ã¼n */
            padding: 20px;
            background-color: #FFEB3B;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            color: #333;
            height: fit-content;
            border: 5px solid #FFC107;
            transition: all 0.3s ease-in-out;
            margin-top: 0;
            z-index: 0;
            box-sizing: border-box;
        }

        /* MÆLUMAT VÆ STATÄ°STÄ°KA STÄ°LLÆRÄ° - DÉ™yiÅŸiklik yoxdur */
        p {
            font-size: 1.5em;
            font-weight: 600;
            color: #4CAF50;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        #xal-gosterici {
            color: #FF5722;
            font-size: 1.3em;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
        }

        #best-score-gosterici {
            color: #00C853;
            font-size: 1.1em;
            display: block;
            margin-top: 5px;
        }

        /* TÆHLÃœKÆSÄ°ZLÄ°K MESAJI - DÉ™yiÅŸiklik yoxdur */
        #tÉ™hlÃ¼kÉ™sizlik-mesaj {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            font-weight: bold;
            display: none; 
            z-index: 9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            font-family: 'Luckiest Guy', cursive;
            font-size: 1.1em;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); background-color: #4CAF50; }
            to { transform: scale(1.05); background-color: #8BC34A; }
        }

        /* BAR KONTEYNERÄ° - DÉ™yiÅŸiklik yoxdur */
        #bar-konteyner {
            width: 100%;
            background-color: #BDBDB;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
            border: 4px solid #757575;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4);
        }

        /* SAÄLAMLIQ BARI - DÉ™yiÅŸiklik yoxdur */
        #saÄŸlamlÄ±q-barÄ± {
            height: 30px;
            width: 100%; 
            background-color: #4CAF50; 
            transition: width 0.1s linear, background-color 0.2s; 
            text-align: center;
            line-height: 30px;
            color: white;
            font-weight: bold;
            font-family: 'Changa One', cursive;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            font-size: 1.1em;
            box-sizing: border-box;
            background-image: linear-gradient(45deg, rgba(255,255,255,.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.2) 50%, rgba(255,255,255,.2) 75%, transparent 75%, transparent);
            background-size: 15px 15px;
        }
        #saÄŸlamlÄ±q-barÄ±.critial { background-color: #FF5722; }
        #saÄŸlamlÄ±q-barÄ±.warning { background-color: #FFC107; }
        #saÄŸlamlÄ±q-barÄ±.normal { background-color: #4CAF50; }


        /* OYUN BÄ°TDÄ° & BAÅLAMA MENYUSU - DÉ™yiÅŸiklik yoxdur */
        #oyun-bitdi-mesaj, #baÅŸlama-menyu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: #FFEB3B;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10;
            font-size: 2.5em;
            border-radius: 35px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.8);
            transition: opacity 0.3s;
        }
        
        #oyun-bitdi-mesaj {
            display: none;
        }
        
        #oyun-bitdi-mesaj h2, #baÅŸlama-menyu h2 {
            font-family: 'Luckiest Guy', cursive;
            font-size: 1.3em;
            color: #FF5722;
            -webkit-text-stroke: 1px #FFEB3B;
        }
        
        #oyun-bitdi-mesaj p, #baÅŸlama-menyu p {
            color: #E0F2F7;
            font-size: 0.8em;
            margin: 8px 0;
        }
        
        #baÅŸlama-menyu input[type="text"] {
            padding: 10px;
            margin: 10px 0 20px 0;
            border-radius: 8px;
            border: 3px solid #FF9800;
            font-size: 0.7em;
            text-align: center;
            font-family: 'Varela Round', sans-serif;
            width: 70%;
            max-width: 300px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        #oyun-bitdi-mesaj button, #baÅŸlama-menyu button {
            padding: 12px 25px;
            font-size: 1.3em;
            cursor: pointer;
            border-radius: 10px;
            background-color: #FF5722;
            color: white;
            border: 3px solid #FFC107;
            box-shadow: 0 5px #E64A19;
            transition: all 0.1s ease;
            font-family: 'Luckiest Guy', cursive;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        #oyun-bitdi-mesaj button:hover, #baÅŸlama-menyu button:hover {
            background-color: #E64A19;
            transform: translateY(-1px);
        }

        #oyun-bitdi-mesaj button:active, #baÅŸlama-menyu button:active {
            box-shadow: 0 1px #E64A19;
            transform: translateY(2px);
        }

        .discord-link {
            font-size: 0.6em;
            margin-top: 15px;
        }

        .discord-link a {
            color: #7289DA;
            text-decoration: none;
            font-weight: bold;
            text-shadow: none;
        }
        
        .klik-effekti {
            position: absolute;
            font-size: 25px;
            font-weight: bold;
            pointer-events: none;
            opacity: 1;
            animation: firlanma 0.8s ease-out forwards;
            z-index: 11;
            font-family: 'Luckiest Guy', cursive;
        }

        @keyframes firlanma {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-70px) scale(1.5); opacity: 0; }
        }

        /* SIRALAMA LÄ°STÄ°NÄ°N XÃœSUSÄ° STÄ°LLÆRÄ° */
        #sÄ±ralama-listi {
            list-style: none;
            padding: 0;
            margin: 15px 0 0 0;
            text-align: left;
            counter-reset: ranking-counter;
        }

        #sÄ±ralama-listi li {
            counter-increment: ranking-counter;
            padding: 8px 0;
            border-bottom: 1px dashed #FF9800;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
        }

        #sÄ±ralama-listi li:last-child {
            border-bottom: none;
        }
        
        #sÄ±ralama-listi li:nth-child(1) { color: #FFD700; font-size: 1.2em; } /* QÄ±zÄ±l */
        #sÄ±ralama-listi li:nth-child(2) { color: #C0C0C0; font-size: 1.15em; } /* GÃ¼mÃ¼ÅŸ */
        #sÄ±ralama-listi li:nth-child(3) { color: #CD7F32; font-size: 1.1em; } /* BÃ¼rÃ¼nc */

        .sÄ±ra-adÄ± {
            font-weight: normal;
            font-family: 'Varela Round', sans-serif;
            margin-left: 5px;
        }
        
        .sÄ±ra-xalÄ± {
            color: #FF5722;
        }

        @media (max-width: 950px) {
            
            #ana-konteyner {
                flex-direction: column; /* Mobil gÃ¶rÃ¼nÃ¼ÅŸdÉ™ alt-alta dÃ¼zÃ¼lmÉ™ */
                align-items: center;
            }

            #oyun-konteyner {
                padding: 15px;
                border-width: 6px;
                max-width: 98%; /* KiÃ§ik ekranlarda daha Ã§ox yer qalsÄ±n */
                width: 100%;
                order: 1; /* Oyun konteyneri birinci gÉ™lsin */
            }

            #oyun-sahÉ™si {
                height: 300px; /* Mobil Ã¼Ã§Ã¼n hÃ¼ndÃ¼rlÃ¼k azaldÄ±ldÄ± */
                border-width: 4px;
            }

            #sÄ±ralama-konteyner {
                width: 100%;
                max-width: 98%;
                order: 2; /* SÄ±ralama konteyneri ikinci gÉ™lsin */
                margin-top: 20px;
            }
            
            #oyun-bitdi-mesaj, #baÅŸlama-menyu {
                font-size: 2em; /* Mobil Ã¼Ã§Ã¼n ÅŸrift kiÃ§ildildi */
            }
            
            #oyun-bitdi-mesaj h2, #baÅŸlama-menyu h2 {
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 480px) {
            #oyun-sahÉ™si {
                height: 250px; /* Ã‡ox kiÃ§ik ekranlar Ã¼Ã§Ã¼n hÃ¼ndÃ¼rlÃ¼k daha da azaldÄ±ldÄ± */
            }
        }
    </style>
</head>
<body>
    <audio id="banana-sÉ™si" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/click.mp3" preload="auto"></audio>
    <audio id="bomba-sÉ™si" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/error.mp3" preload="auto"></audio>
    <audio id="bitdi-sÉ™si" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/gameover.mp3" preload="auto"></audio>
    <audio id="meymun-sÉ™si" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/reward.mp3" preload="auto"></audio> <audio id="zireh-sÉ™si" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/level_up.mp3" preload="auto"></audio>

    <div id="ana-konteyner">
        <div id="oyun-konteyner">
            <p>Xal: <span id="xal-gosterici">0</span> <span id="best-score-gosterici"></span></p>

            <div id="tÉ™hlÃ¼kÉ™sizlik-mesaj">ğŸ’ Zireh Aktiv! 60s ğŸ›¡ï¸</div> 
            
            <div id="bar-konteyner">
                <div id="saÄŸlamlÄ±q-barÄ±" class="normal">ENERJÄ°</div>
            </div>

            <canvas id="oyun-sahÉ™si">
                Brauzeriniz Canvas elementini dÉ™stÉ™klÉ™mir.
            </canvas>

            <div id="baÅŸlama-menyu">
                <p>NÉ™ qÉ™dÉ™r banana toplaya bilÉ™rsÉ™n?</p>
                <input type="text" id="istifadÉ™Ã§i-adÄ±-input" placeholder="AdÄ±nÄ±zÄ± daxil edin" maxlength="15">
                <button onclick="oyunuBaslat()">Oyuna BaÅŸla</button>
                <p style="font-size: 0.6em; color: #a9a9a9;">(Bomba vursanÄ±z xalÄ±nÄ±z azalacaq vÉ™ enerjiniz bitÉ™cÉ™k!)</p>
                <p class="discord-link">
                    Discord'umuza QoÅŸul: <a href="https://discord.gg/erqaQTsPp6" target="_blank">Discord Server</a>
                </p>
            </div>

            <div id="oyun-bitdi-mesaj">
                <h2>OYUN BÄ°TDÄ°!</h2>
                <p>Sizin XalÄ±nÄ±z: <span id="son-xal">0</span></p>
                <p id="final-best-score">Æn YaxÅŸÄ± Yerli Xal: 0</p>
                <button onclick="window.location.reload()">YenidÉ™n BaÅŸla</button>
            </div>
        </div>

        <div id="sÄ±ralama-konteyner">
            <h2>ğŸ† SÄ±ralama ğŸ†</h2>
            <ul id="sÄ±ralama-listi">
                <li>YÃ¼klÉ™nir...</li>
            </ul>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB-fcBC0V-dLgKJ5tbqBMS_nJlvv3z-nCs",
            authDomain: "banan-5e794.firebaseapp.com",
            projectId: "banan-5e794",
            storageBucket: "banan-5e794.firebasestorage.app",
            messagingSenderId: "646517025148",
            appId: "1:646517025148:web:8fd6ec0a1f96d8c3c9dcf9",
            measurementId: "G-LRJD9W7YHE"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const canvas = document.getElementById('oyun-sahÉ™si');
        const ctx = canvas.getContext('2d');
        const xalGosterici = document.getElementById('xal-gosterici');
        const saÄŸlamlÄ±qBarÄ± = document.getElementById('saÄŸlamlÄ±q-barÄ±');
        const oyunBitdiMesaj = document.getElementById('oyun-bitdi-mesaj');
        const sonXalGosterici = document.getElementById('son-xal');
        const sÄ±ralamaListi = document.getElementById('sÄ±ralama-listi');
        const bestScoreGosterici = document.getElementById('best-score-gosterici');
        const finalBestScoreGosterici = document.getElementById('final-best-score');
        const baÅŸlamaMenyu = document.getElementById('baÅŸlama-menyu');
        const istifadÉ™Ã§iAdÄ±Input = document.getElementById('istifadÉ™Ã§i-adÄ±-input');
        const tÉ™hlÃ¼kÉ™sizlikMesaj = document.getElementById('tÉ™hlÃ¼kÉ™sizlik-mesaj');
        
        const bananaSÉ™si = document.getElementById('banana-sÉ™si');
        const bombaSÉ™si = document.getElementById('bomba-sÉ™si');
        const bitdiSÉ™si = document.getElementById('bitdi-sÉ™si');
        const meymunSÉ™si = document.getElementById('meymun-sÉ™si');
        const zirehSÉ™si = document.getElementById('zireh-sÉ™si');

        const LOCAL_STORAGE_KEY = 'banana_best_score';
        const USER_NAME_KEY = 'banana_user_name';
        let cariUserName = 'Anonim';

        function isMobile() {
            return /Mobi|Android|iPhone|iPad|Windows Phone/i.test(navigator.userAgent);
        }

        function getBestScore() {
            return parseInt(localStorage.getItem(LOCAL_STORAGE_KEY) || '0', 10);
        }

        function updateBestScore(newScore) {
            const currentBest = getBestScore();
            if (newScore > currentBest) {
                localStorage.setItem(LOCAL_STORAGE_KEY, newScore);
                bestScoreGosterici.textContent = `Æn YaxÅŸÄ± Yerli Xal: ${newScore}`;
            }
        }

        let xal = 0;
        let sonYenilÉ™nmÉ™VaxtÄ± = 0;
        const obyektÃ–lÃ§Ã¼sÃ¼ = 60;

        const mobilSÃ¼rÉ™t = 300; 
        const desktopSÃ¼rÉ™t = 600;
        let yenilÉ™nmÉ™AralÄ±ÄŸÄ± = isMobile() ? mobilSÃ¼rÉ™t : desktopSÃ¼rÉ™t; 

        let firlanmaBucaÄŸÄ± = 0;
        const firlanmaSÃ¼rÉ™ti = 0.1;

        let cariBarDÉ™yÉ™ri = 100; 
        const azalmaSÃ¼rÉ™ti = 0.07;
        const artÄ±rmaDÉ™yÉ™ri = 30;
        const bombaCÉ™zasÄ± = 40;
        let oyunAktiv = false;

        let cariObyekt = null; 
        let tÉ™hlÃ¼kÉ™sizlikRejimiAktiv = false;
        const tÉ™hlÃ¼kÉ™sizlikMÃ¼ddÉ™ti = 10000;

        let storedName = localStorage.getItem(USER_NAME_KEY);
        if (storedName) {
            istifadÉ™Ã§iAdÄ±Input.value = storedName;
            cariUserName = storedName;
        }
        
        const meymunGÉ™lmÉ™EhtimalÄ± = 0.1; 

        function tÉ™sadÃ¼fiYerYarat() {
            let nÃ¶vÃ¼;
            if (tÉ™hlÃ¼kÉ™sizlikRejimiAktiv) {
                nÃ¶vÃ¼ = 'banana';
            } else {
                const rand = Math.random();
                if (rand < 0.7) {
                    nÃ¶vÃ¼ = 'banana';
                } else if (rand < 0.95) {
                    nÃ¶vÃ¼ = 'bomba';
                } else {
                    nÃ¶vÃ¼ = 'meymun'; 
                }
            }
            
            return {
                // X vÉ™ Y koordinatlarÄ± Ã¼Ã§Ã¼n canvas.width/height istifadÉ™ edilir
                x: Math.random() * (canvas.width - obyektÃ–lÃ§Ã¼sÃ¼),
                y: Math.random() * (canvas.height - obyektÃ–lÃ§Ã¼sÃ¼),
                nÃ¶vÃ¼: nÃ¶vÃ¼,
                Ã¶lÃ§Ã¼: obyektÃ–lÃ§Ã¼sÃ¼,
                fÄ±rlanma: 0 
            };
        }

        function obyektlÉ™riÃ‡É™k() {
            if (!cariObyekt) return;
            
            ctx.save();
            const mÉ™rkÉ™zX = cariObyekt.x + cariObyekt.Ã¶lÃ§Ã¼ / 2;
            const mÉ™rkÉ™zY = cariObyekt.y + cariObyekt.Ã¶lÃ§Ã¼ / 2;
            
            ctx.translate(mÉ™rkÉ™zX, mÉ™rkÉ™zY);
            ctx.rotate(firlanmaBucaÄŸÄ±);
            ctx.translate(-mÉ™rkÉ™zX, -mÉ™rkÉ™zY);

            // Obyekt Ã¶lÃ§Ã¼sÃ¼ ekran geniÅŸliyinÉ™ gÃ¶rÉ™ tÉ™nzimlÉ™nÉ™ bilÉ™r (mobil Ã¼Ã§Ã¼n)
            const cariObyektÃ–lÃ§Ã¼sÃ¼ = isMobile() ? obyektÃ–lÃ§Ã¼sÃ¼ * 0.8 : obyektÃ–lÃ§Ã¼sÃ¼;
            
            ctx.font = `${cariObyektÃ–lÃ§Ã¼sÃ¼}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            if (cariObyekt.nÃ¶vÃ¼ === 'banana') {
                ctx.fillText('ğŸŒ', mÉ™rkÉ™zX, mÉ™rkÉ™zY);
            } else if (cariObyekt.nÃ¶vÃ¼ === 'bomba') {
                ctx.fillText('ğŸ’£', mÉ™rkÉ™zX, mÉ™rkÉ™zY);
            } else if (cariObyekt.nÃ¶vÃ¼ === 'meymun') {
                ctx.fillText('ğŸ’', mÉ™rkÉ™zX, mÉ™rkÉ™zY);
            }

            ctx.restore();
        }
        
        function obyektYeriYenilÉ™() {
            cariObyekt = tÉ™sadÃ¼fiYerYarat();
        }
        
        function tÉ™hlÃ¼kÉ™sizlikRejiminiAktivlÉ™ÅŸdir() {
            if (tÉ™hlÃ¼kÉ™sizlikRejimiAktiv) return; 

            tÉ™hlÃ¼kÉ™sizlikRejimiAktiv = true;
            zirehSÉ™si.play(); 
            tÉ™hlÃ¼kÉ™sizlikMesaj.style.display = 'block';

            let saniyÉ™ = tÉ™hlÃ¼kÉ™sizlikMÃ¼ddÉ™ti / 1000;
            tÉ™hlÃ¼kÉ™sizlikMesaj.textContent = `ğŸ’ Zireh Aktiv! ${saniyÉ™}s ğŸ›¡ï¸`;

            const intervalId = setInterval(() => {
                saniyÉ™--;
                tÉ™hlÃ¼kÉ™sizlikMesaj.textContent = `ğŸ’ Zireh Aktiv! ${saniyÉ™}s ğŸ›¡ï¸`;

                if (saniyÉ™ <= 0) {
                    clearInterval(intervalId);
                    tÉ™hlÃ¼kÉ™sizlikRejimiAktiv = false;
                    tÉ™hlÃ¼kÉ™sizlikMesaj.style.display = 'none';
                    obyektYeriYenilÉ™();
                }
            }, 1000); 
        }

        function yaratKlikEffekti(x, y, nÃ¶vÃ¼) {
            const effekt = document.createElement('div');
            
            if (nÃ¶vÃ¼ === 'banana') {
                effekt.textContent = '+1';
                effekt.style.color = '#8BC34A';
            } else if (nÃ¶vÃ¼ === 'bomba') {
                effekt.textContent = tÉ™hlÃ¼kÉ™sizlikRejimiAktiv ? 'QORUNDU!' : '-3 XAL!';
                effekt.style.color = tÉ™hlÃ¼kÉ™sizlikRejimiAktiv ? '#7289DA' : '#FF5722';
            } else if (nÃ¶vÃ¼ === 'meymun') {
                effekt.textContent = 'ğŸ›¡ï¸ ZÄ°REH! ğŸ›¡ï¸';
                effekt.style.color = '#7289DA';
            }
            
            effekt.classList.add('klik-effekti');
            
            const rect = canvas.getBoundingClientRect();
            // KoordinatlarÄ± `body` yox, `canvas` konteynerinÉ™ gÃ¶rÉ™ tÉ™nzimlÉ™yin.
            effekt.style.left = (rect.left + x) + 'px';
            effekt.style.top = (rect.top + y) + 'px';

            document.body.appendChild(effekt);

            effekt.addEventListener('animationend', () => {
                effekt.remove();
            });
        }

        function barÄ±YenilÉ™() {
            if (!oyunAktiv) return;

            cariBarDÉ™yÉ™ri -= azalmaSÃ¼rÉ™ti;

            if (cariBarDÉ™yÉ™ri < 0) {
                cariBarDÉ™yÉ™ri = 0;
            } else if (cariBarDÉ™yÉ™ri > 100) {
                 cariBarDÉ™yÉ™ri = 100;
            }

            saÄŸlamlÄ±qBarÄ±.style.width = cariBarDÉ™yÉ™ri + '%';
            saÄŸlamlÄ±qBarÄ±.textContent = `ENERJÄ° (${Math.round(cariBarDÉ™yÉ™ri)}%)`;
            
            saÄŸlamlÄ±qBarÄ±.classList.remove('normal', 'warning', 'critial');
            if (cariBarDÉ™yÉ™ri < 25) {
                saÄŸlamlÄ±qBarÄ±.classList.add('critial');
            } else if (cariBarDÉ™yÉ™ri < 50) {
                saÄŸlamlÄ±qBarÄ±.classList.add('warning');
            } else {
                saÄŸlamlÄ±qBarÄ±.classList.add('normal');
            }

            if (cariBarDÉ™yÉ™ri <= 0) {
                oyunAktiv = false;
                oyunuBitir();
            }
        }
        
        function xalÄ±YaddaSaxla(yekunXal) {
            if (yekunXal === 0) return;

            db.collection("leaderboard").add({
                ad: cariUserName,
                xal: yekunXal, 
                tarix: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                sÄ±ralamanÄ±YÃ¼klÉ™();
            })
            .catch((error) => {
                console.error("Xal yazÄ±larkÉ™n xÉ™ta:", error);
            });
        }

        function sÄ±ralamanÄ±YÃ¼klÉ™() {
            sÄ±ralamaListi.innerHTML = '<li><span class="sÄ±ra-adÄ±">YÃ¼klÉ™nir...</span></li>';

            db.collection("leaderboard")
              .orderBy("xal", "desc")
              .limit(10) 
              .get()
              .then((snapshot) => {
                sÄ±ralamaListi.innerHTML = ''; 
                if (snapshot.empty) {
                    sÄ±ralamaListi.innerHTML = '<li>HÉ™lÉ™lik heÃ§ bir nÉ™ticÉ™ yoxdur.</li>';
                    return;
                }
                
                let sÄ±ra = 1;
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const li = document.createElement('li');
                    li.innerHTML = `
                      <span>${sÄ±ra}. <span class="sÄ±ra-adÄ±">${data.ad}</span></span> 
                      <span class="sÄ±ra-xalÄ±">${data.xal}</span>
                    `;
                    sÄ±ralamaListi.appendChild(li);
                    sÄ±ra++;
                });
              })
              .catch((error) => {
                sÄ±ralamaListi.innerHTML = `<li><span class="sÄ±ra-adÄ±">XÉ™ta: MÉ™lumat oxunmadÄ±.</span></li>`;
                console.error("SÄ±ralama xÉ™tasÄ±:", error);
              });
        }

        function oyunuBitir() {
            bitdiSÉ™si.play();
            updateBestScore(xal);
            sonXalGosterici.textContent = xal;
            finalBestScoreGosterici.textContent = `Æn YaxÅŸÄ± Yerli Xal: ${getBestScore()}`;
            oyunBitdiMesaj.style.display = 'flex';
            canvas.style.opacity = '0.3';
            tÉ™hlÃ¼kÉ™sizlikMesaj.style.display = 'none';
            tÉ™hlÃ¼kÉ™sizlikRejimiAktiv = false;
            
            xalÄ±YaddaSaxla(xal); 
        }

        function yenilÉ™(cariVaxt) {
            if (!oyunAktiv) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            barÄ±YenilÉ™();

            firlanmaBucaÄŸÄ± += firlanmaSÃ¼rÉ™ti;

            if (cariVaxt - sonYenilÉ™nmÉ™VaxtÄ± > yenilÉ™nmÉ™AralÄ±ÄŸÄ±) {
                obyektYeriYenilÉ™();
                sonYenilÉ™nmÉ™VaxtÄ± = cariVaxt;
            }

            obyektlÉ™riÃ‡É™k();

            requestAnimationFrame(yenilÉ™);
        }

        // TÉ™krar kodun qarÅŸÄ±sÄ±nÄ± almaq Ã¼Ã§Ã¼n funksiya yarat
        function handleInteraction(klikX, klikY) {
             if (!oyunAktiv || !cariObyekt) return;
             
             // Obyekt Ã¶lÃ§Ã¼sÃ¼ mobil Ã¼Ã§Ã¼n kiÃ§ik olduÄŸu Ã¼Ã§Ã¼n tolerantlÄ±ÄŸÄ± da tÉ™nzimlÉ™yin
             const cariObyektÃ–lÃ§Ã¼sÃ¼ = isMobile() ? obyektÃ–lÃ§Ã¼sÃ¼ * 0.8 : obyektÃ–lÃ§Ã¼sÃ¼; 
             const tolerantlÄ±q = isMobile() ? 15 : 5; 

            if (
                klikX >= cariObyekt.x - tolerantlÄ±q &&
                klikX <= cariObyekt.x + cariObyektÃ–lÃ§Ã¼sÃ¼ + tolerantlÄ±q &&
                klikY >= cariObyekt.y - tolerantlÄ±q &&
                klikY <= cariObyekt.y + cariObyektÃ–lÃ§Ã¼sÃ¼ + tolerantlÄ±q
            ) {
                let obyektNÃ¶vÃ¼ = cariObyekt.nÃ¶vÃ¼;
                
                if (obyektNÃ¶vÃ¼ === 'banana') {
                    xal++;
                    cariBarDÉ™yÉ™ri += artÄ±rmaDÉ™yÉ™ri;
                    bananaSÉ™si.currentTime = 0;
                    bananaSÉ™si.play();
                } else if (obyektNÃ¶vÃ¼ === 'bomba') { 
                    if (!tÉ™hlÃ¼kÉ™sizlikRejimiAktiv) {
                        xal = Math.max(0, xal - 3); 
                        cariBarDÉ™yÉ™ri -= bombaCÉ™zasÄ±; 
                    } 
                    bombaSÉ™si.currentTime = 0;
                    bombaSÉ™si.play();
                } else if (obyektNÃ¶vÃ¼ === 'meymun') {
                    meymunSÉ™si.currentTime = 0;
                    meymunSÉ™si.play();
                    tÉ™hlÃ¼kÉ™sizlikRejiminiAktivlÉ™ÅŸdir();
                }
                
                // Klik effektini mÉ™rkÉ™zdÉ™ gÃ¶stÉ™rmÉ™k Ã¼Ã§Ã¼n
                const mÉ™rkÉ™zX = cariObyekt.x + cariObyektÃ–lÃ§Ã¼sÃ¼ / 2; 
                const mÉ™rkÉ™zY = cariObyekt.y + cariObyektÃ–lÃ§Ã¼sÃ¼ / 2;
                yaratKlikEffekti(mÉ™rkÉ™zX, mÉ™rkÉ™zY, obyektNÃ¶vÃ¼);
                
                xalGosterici.textContent = xal;
                
                obyektYeriYenilÉ™();
                sonYenilÉ™nmÉ™VaxtÄ± = performance.now();
                updateBestScore(xal);
                
                if (cariBarDÉ™yÉ™ri > 100) cariBarDÉ™yÉ™ri = 100;
            }
        }

        canvas.addEventListener('click', function(e) {
            const rect = canvas.getBoundingClientRect();
            const klikX = e.clientX - rect.left;
            const klikY = e.clientY - rect.top;
            handleInteraction(klikX, klikY);
        });

        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault(); 
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const klikX = touch.clientX - rect.left;
            const klikY = touch.clientY - rect.top;
            handleInteraction(klikX, klikY);
        }, { passive: false });

        function oyunuBaslat() {
            const userName = istifadÉ™Ã§iAdÄ±Input.value.trim() || 'Anonim';
            if (userName.length < 2 || userName.length > 15) {
                alert("Ad minimum 2, maksimum 15 simvol olmalÄ±dÄ±r.");
                return;
            }
            
            cariUserName = userName;
            localStorage.setItem(USER_NAME_KEY, userName);
            
            baÅŸlamaMenyu.style.display = 'none';
            oyunAktiv = true;
            xal = 0;
            cariBarDÉ™yÉ™ri = 100;
            xalGosterici.textContent = xal;
            canvas.style.opacity = '1';
            
            obyektYeriYenilÉ™();
            sonYenilÉ™nmÉ™VaxtÄ± = performance.now();
            yenilÉ™(performance.now());
        }
        
        // Canvas Ã¶lÃ§Ã¼sÃ¼nÃ¼ tÉ™nzimlÉ™yÉ™n funksiya
        function canvasÃ–lÃ§Ã¼sÃ¼nÃ¼TÉ™nzimlÉ™() {
            // CSS tÉ™rÉ™findÉ™n verilÉ™n `offsetWidth` vÉ™ `offsetHeight` dÉ™yÉ™rlÉ™rini gÃ¶tÃ¼rÃ¼r
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }

        function ilkinYÃ¼klÉ™nmÉ™() {
            canvasÃ–lÃ§Ã¼sÃ¼nÃ¼TÉ™nzimlÉ™(); // BaÅŸlanÄŸÄ±cda Ã¶lÃ§Ã¼ tÉ™nzimlÉ™nmÉ™si
            bestScoreGosterici.textContent = `Æn yÃ¼ksÉ™k skorunuz: ${getBestScore()}`;
            sÄ±ralamanÄ±YÃ¼klÉ™(); 
            yenilÉ™nmÉ™AralÄ±ÄŸÄ± = isMobile() ? mobilSÃ¼rÉ™t : desktopSÃ¼rÉ™t; 
        }

        ilkinYÃ¼klÉ™nmÉ™();

        window.addEventListener('resize', () => {
             canvasÃ–lÃ§Ã¼sÃ¼nÃ¼TÉ™nzimlÉ™(); // Ekran Ã¶lÃ§Ã¼sÃ¼ dÉ™yiÅŸdikdÉ™ yenidÉ™n tÉ™nzimlÉ™
             yenilÉ™nmÉ™AralÄ±ÄŸÄ± = isMobile() ? mobilSÃ¼rÉ™t : desktopSÃ¼rÉ™t; 
        });
    </script>
</body>

</html>
