<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANAN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Changa+One:ital@0;1&family=Varela+Round&display=swap');
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #FFC107, #FF9800, #FFC107);
            font-family: 'Varela Round', sans-serif;
            color: #333;
            padding: 10px;
            overflow: hidden;
        }

        #ana-konteyner {
            display: flex;
            flex-wrap: nowrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 10px;
            box-sizing: border-box;
        }

        #oyun-konteyner {
            flex-shrink: 0;
            width: 650px;
            max-width: 95%;
            text-align: center;
            padding: 25px;
            background-color: #FFFDE7;
            border-radius: 35px;
            border: 10px solid #8BC34A;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 50px rgba(139, 195, 74, 0.5);
            position: relative;
            transition: all 0.3s ease-in-out;
            z-index: 1;
        }
        
        #oyun-konteyner:hover {
            transform: translateY(-5px) scale(1.0);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6), 0 0 70px rgba(139, 195, 74, 0.7);
        }

        #oyun-sah…ôsi {
            border: 6px dashed #FF9800;
            background-color: #E0F2F7;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewport="0 0 100 100" style="fill:black;font-size:20px;"><text y="50%">üëÜ</text></svg>') 17 17, auto; 
            display: block;
            margin: 15px auto 15px;
            border-radius: 20px;
            touch-action: manipulation; 
            max-width: 100%;
            height: 400px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
            opacity: 0.3;
        }
        
        p {
            font-size: 1.5em;
            font-weight: 600;
            color: #4CAF50;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        #xal-gosterici {
            color: #FF5722;
            font-size: 1.3em;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
        }

        #best-score-gosterici {
            color: #00C853;
            font-size: 1.1em;
            display: block;
            margin-top: 5px;
        }

        /* Yeni stil: T…ôhl√ºk…ôsizlik rejimi mesajƒ± */
        #t…ôhl√ºk…ôsizlik-mesaj {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            font-weight: bold;
            display: none; /* Ba≈ülanƒüƒ±cda gizli */
            z-index: 9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            font-family: 'Luckiest Guy', cursive;
            font-size: 1.1em;
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); background-color: #4CAF50; }
            to { transform: scale(1.05); background-color: #8BC34A; }
        }
        
        #bar-konteyner {
            width: 100%;
            background-color: #BDBDB;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
            border: 4px solid #757575;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4);
        }

        #saƒülamlƒ±q-barƒ± {
            height: 30px;
            width: 100%; 
            background-color: #4CAF50; 
            transition: width 0.1s linear, background-color 0.2s; 
            text-align: center;
            line-height: 30px;
            color: white;
            font-weight: bold;
            font-family: 'Changa One', cursive;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            font-size: 1.1em;
            box-sizing: border-box;
            background-image: linear-gradient(45deg, rgba(255,255,255,.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.2) 50%, rgba(255,255,255,.2) 75%, transparent 75%, transparent);
            background-size: 15px 15px;
        }
        #saƒülamlƒ±q-barƒ±.critial { background-color: #FF5722; }
        #saƒülamlƒ±q-barƒ±.warning { background-color: #FFC107; }
        #saƒülamlƒ±q-barƒ±.normal { background-color: #4CAF50; }


        #oyun-bitdi-mesaj, #ba≈ülama-menyu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: #FFEB3B;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10;
            font-size: 2.5em;
            border-radius: 35px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.8);
            transition: opacity 0.3s;
        }
        
        #oyun-bitdi-mesaj {
            display: none;
        }
        
        #oyun-bitdi-mesaj h2, #ba≈ülama-menyu h2 {
            font-family: 'Luckiest Guy', cursive;
            font-size: 1.3em;
            color: #FF5722;
            -webkit-text-stroke: 1px #FFEB3B;
        }
        
        #oyun-bitdi-mesaj p, #ba≈ülama-menyu p {
            color: #E0F2F7;
            font-size: 0.8em;
            margin: 8px 0;
        }
        
        #ba≈ülama-menyu input[type="text"] {
            padding: 10px;
            margin: 10px 0 20px 0;
            border-radius: 8px;
            border: 3px solid #FF9800;
            font-size: 0.7em;
            text-align: center;
            font-family: 'Varela Round', sans-serif;
            width: 70%;
            max-width: 300px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        #oyun-bitdi-mesaj button, #ba≈ülama-menyu button {
            padding: 12px 25px;
            font-size: 1.3em;
            cursor: pointer;
            border-radius: 10px;
            background-color: #FF5722;
            color: white;
            border: 3px solid #FFC107;
            box-shadow: 0 5px #E64A19;
            transition: all 0.1s ease;
            font-family: 'Luckiest Guy', cursive;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        #oyun-bitdi-mesaj button:hover, #ba≈ülama-menyu button:hover {
            background-color: #E64A19;
            transform: translateY(-1px);
        }

        #oyun-bitdi-mesaj button:active, #ba≈ülama-menyu button:active {
            box-shadow: 0 1px #E64A19;
            transform: translateY(2px);
        }

        .discord-link {
            font-size: 0.6em;
            margin-top: 15px;
        }

        .discord-link a {
            color: #7289DA;
            text-decoration: none;
            font-weight: bold;
            text-shadow: none;
        }
        
        .klik-effekti {
            position: absolute;
            font-size: 25px;
            font-weight: bold;
            pointer-events: none;
            opacity: 1;
            animation: firlanma 0.8s ease-out forwards;
            z-index: 11;
            font-family: 'Luckiest Guy', cursive;
        }

        @keyframes firlanma {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-70px) scale(1.5); opacity: 0; }
        }

        #sƒ±ralama-konteyner {
            flex-shrink: 0;
            width: 250px;
            max-width: 95%;
            padding: 20px;
            background-color: #FFEB3B;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            color: #333;
            height: fit-content;
            border: 5px solid #FFC107;
            transition: all 0.3s ease-in-out;
            margin-top: 0;
            z-index: 0;
        }
        
        /* ∆èlav…ô media sorƒüularƒ± burada ola bil…ôr */
    </style>
</head>
<body>
    <audio id="banana-s…ôsi" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/click.mp3" preload="auto"></audio>
    <audio id="bomba-s…ôsi" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/error.mp3" preload="auto"></audio>
    <audio id="bitdi-s…ôsi" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/gameover.mp3" preload="auto"></audio>
    <audio id="meymun-s…ôsi" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/reward.mp3" preload="auto"></audio> <audio id="zireh-s…ôsi" src="https://cdn.jsdelivr.net/gh/google/flatpickr-mobile/example/sounds/level_up.mp3" preload="auto"></audio>

    <div id="ana-konteyner">
        <div id="oyun-konteyner">
            <p>Xal: <span id="xal-gosterici">0</span> <span id="best-score-gosterici"></span></p>

            <div id="t…ôhl√ºk…ôsizlik-mesaj">üêí Zireh Aktiv! 60s üõ°Ô∏è</div> 
            
            <div id="bar-konteyner">
                <div id="saƒülamlƒ±q-barƒ±" class="normal">ENERJƒ∞</div>
            </div>

            <canvas id="oyun-sah…ôsi" width="600" height="400">
                Brauzeriniz Canvas elementini d…ôst…ôkl…ômir.
            </canvas>

            <div id="ba≈ülama-menyu">
                <p>N…ô q…ôd…ôr banana toplaya bil…ôrs…ôn?</p>
                <input type="text" id="istifad…ô√ßi-adƒ±-input" placeholder="Adƒ±nƒ±zƒ± daxil edin" maxlength="15">
                <button onclick="oyunuBaslat()">Oyuna Ba≈üla</button>
                <p style="font-size: 0.6em; color: #a9a9a9;">(Bomba vursanƒ±z xalƒ±nƒ±z azalacaq v…ô enerjiniz bit…ôc…ôk!)</p>
                <p class="discord-link">
                    Discord'umuza Qo≈üul: <a href="https://discord.gg/erqaQTsPp6" target="_blank">Discord Server</a>
                </p>
            </div>

            <div id="oyun-bitdi-mesaj">
                <h2>OYUN Bƒ∞TDƒ∞!</h2>
                <p>Sizin Xalƒ±nƒ±z: <span id="son-xal">0</span></p>
                <p id="final-best-score">∆èn Yax≈üƒ± Yerli Xal: 0</p>
                <button onclick="window.location.reload()">Yenid…ôn Ba≈üla</button>
            </div>
        </div>

        <div id="sƒ±ralama-konteyner">
            <h2>üèÜ Sƒ±ralama üèÜ</h2>
            <ul id="sƒ±ralama-listi">
                <li>Y√ºkl…ônir...</li>
            </ul>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB-fcBC0V-dLgKJ5tbqBMS_nJlvv3z-nCs",
            authDomain: "banan-5e794.firebaseapp.com",
            projectId: "banan-5e794",
            storageBucket: "banan-5e794.firebasestorage.app",
            messagingSenderId: "646517025148",
            appId: "1:646517025148:web:8fd6ec0a1f96d8c3c9dcf9",
            measurementId: "G-LRJD9W7YHE"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const canvas = document.getElementById('oyun-sah…ôsi');
        const ctx = canvas.getContext('2d');
        const xalGosterici = document.getElementById('xal-gosterici');
        const saƒülamlƒ±qBarƒ± = document.getElementById('saƒülamlƒ±q-barƒ±');
        const oyunBitdiMesaj = document.getElementById('oyun-bitdi-mesaj');
        const sonXalGosterici = document.getElementById('son-xal');
        const sƒ±ralamaListi = document.getElementById('sƒ±ralama-listi');
        const bestScoreGosterici = document.getElementById('best-score-gosterici');
        const finalBestScoreGosterici = document.getElementById('final-best-score');
        const ba≈ülamaMenyu = document.getElementById('ba≈ülama-menyu');
        const istifad…ô√ßiAdƒ±Input = document.getElementById('istifad…ô√ßi-adƒ±-input');
        const t…ôhl√ºk…ôsizlikMesaj = document.getElementById('t…ôhl√ºk…ôsizlik-mesaj');
        
        const bananaS…ôsi = document.getElementById('banana-s…ôsi');
        const bombaS…ôsi = document.getElementById('bomba-s…ôsi');
        const bitdiS…ôsi = document.getElementById('bitdi-s…ôsi');
        const meymunS…ôsi = document.getElementById('meymun-s…ôsi');
        const zirehS…ôsi = document.getElementById('zireh-s…ôsi');

        const LOCAL_STORAGE_KEY = 'banana_best_score';
        const USER_NAME_KEY = 'banana_user_name';
        let cariUserName = 'Anonim';

        function isMobile() {
            return /Mobi|Android|iPhone|iPad|Windows Phone/i.test(navigator.userAgent);
        }

        function getBestScore() {
            return parseInt(localStorage.getItem(LOCAL_STORAGE_KEY) || '0', 10);
        }

        function updateBestScore(newScore) {
            const currentBest = getBestScore();
            if (newScore > currentBest) {
                localStorage.setItem(LOCAL_STORAGE_KEY, newScore);
                bestScoreGosterici.textContent = `∆èn Yax≈üƒ± Yerli Xal: ${newScore}`;
            }
        }

        let xal = 0;
        let sonYenil…ônm…ôVaxtƒ± = 0;
        const obyekt√ñl√ß√ºs√º = 60;

        const mobilS√ºr…ôt = 400; 
        const desktopS√ºr…ôt = 700;
        let yenil…ônm…ôAralƒ±ƒüƒ± = isMobile() ? mobilS√ºr…ôt : desktopS√ºr…ôt; 

        let firlanmaBucaƒüƒ± = 0;
        const firlanmaS√ºr…ôti = 0.1;

        let cariBarD…ôy…ôri = 100; 
        const azalmaS√ºr…ôti = 0.07;
        const artƒ±rmaD…ôy…ôri = 30;
        const bombaC…ôzasƒ± = 40;
        let oyunAktiv = false;

        let cariObyekt = null; 
        let t…ôhl√ºk…ôsizlikRejimiAktiv = false;
        const t…ôhl√ºk…ôsizlikM√ºdd…ôti = 10000; // 10 saniy…ô (ƒ∞stifad…ô√ßinin t…ôl…ôbin…ô uyƒüun olaraq d…ôyi≈üdirildi)

        let storedName = localStorage.getItem(USER_NAME_KEY);
        if (storedName) {
            istifad…ô√ßiAdƒ±Input.value = storedName;
            cariUserName = storedName;
        }
        
        // Bonus Meymunun g…ôlm…ô ehtimalƒ± (M…ôs…ôl…ôn, 10 obyekt…ô bir d…ôf…ô)
        const meymunG…ôlm…ôEhtimalƒ± = 0.1; 

        function t…ôsad√ºfiYerYarat() {
            let n√∂v√º;
            if (t…ôhl√ºk…ôsizlikRejimiAktiv) {
                // T…ôhl√ºk…ôsizlik rejimi aktivdirs…ô, yalnƒ±z banana g…ôlsin
                n√∂v√º = 'banana';
            } else {
                // Normal rejimd…ô bomba v…ô ya banana g…ôl…ô bil…ôr
                const rand = Math.random();
                if (rand < 0.7) {
                    n√∂v√º = 'banana';
                } else if (rand < 0.95) { // 0.7-0.95 aralƒ±ƒüƒ± bomba √º√ß√ºn (0.25 ehtimal)
                    n√∂v√º = 'bomba';
                } else { // 0.95-1.0 aralƒ±ƒüƒ± meymun √º√ß√ºn (0.05 ehtimal)
                    n√∂v√º = 'meymun'; 
                }
            }
            
            return {
                x: Math.random() * (canvas.width - obyekt√ñl√ß√ºs√º),
                y: Math.random() * (canvas.height - obyekt√ñl√ß√ºs√º),
                n√∂v√º: n√∂v√º,
                √∂l√ß√º: obyekt√ñl√ß√ºs√º,
                fƒ±rlanma: 0 
            };
        }

        function obyektl…ôri√á…ôk() {
            if (!cariObyekt) return;
            
            ctx.save();
            const m…ôrk…ôzX = cariObyekt.x + cariObyekt.√∂l√ß√º / 2;
            const m…ôrk…ôzY = cariObyekt.y + cariObyekt.√∂l√ß√º / 2;
            
            ctx.translate(m…ôrk…ôzX, m…ôrk…ôzY);
            ctx.rotate(firlanmaBucaƒüƒ±);
            ctx.translate(-m…ôrk…ôzX, -m…ôrk…ôzY);

            ctx.font = `${cariObyekt.√∂l√ß√º}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            if (cariObyekt.n√∂v√º === 'banana') {
                ctx.fillText('üçå', m…ôrk…ôzX, m…ôrk…ôzY);
            } else if (cariObyekt.n√∂v√º === 'bomba') {
                ctx.fillText('üí£', m…ôrk…ôzX, m…ôrk…ôzY);
            } else if (cariObyekt.n√∂v√º === 'meymun') {
                ctx.fillText('üêí', m…ôrk…ôzX, m…ôrk…ôzY);
            }

            ctx.restore();
        }
        
        function obyektYeriYenil…ô() {
            cariObyekt = t…ôsad√ºfiYerYarat();
        }
        
        function t…ôhl√ºk…ôsizlikRejiminiAktivl…ô≈üdir() {
            if (t…ôhl√ºk…ôsizlikRejimiAktiv) return; 

            t…ôhl√ºk…ôsizlikRejimiAktiv = true;
            zirehS…ôsi.play(); 
            t…ôhl√ºk…ôsizlikMesaj.style.display = 'block';

            let saniy…ô = t…ôhl√ºk…ôsizlikM√ºdd…ôti / 1000;
            t…ôhl√ºk…ôsizlikMesaj.textContent = `üêí Zireh Aktiv! ${saniy…ô}s üõ°Ô∏è`;

            const intervalId = setInterval(() => {
                saniy…ô--;
                t…ôhl√ºk…ôsizlikMesaj.textContent = `üêí Zireh Aktiv! ${saniy…ô}s üõ°Ô∏è`;

                if (saniy…ô <= 0) {
                    clearInterval(intervalId);
                    t…ôhl√ºk…ôsizlikRejimiAktiv = false;
                    t…ôhl√ºk…ôsizlikMesaj.style.display = 'none';
                    obyektYeriYenil…ô();
                }
            }, 1000); 
        }

        function yaratKlikEffekti(x, y, n√∂v√º) {
            const effekt = document.createElement('div');
            
            if (n√∂v√º === 'banana') {
                effekt.textContent = '+1';
                effekt.style.color = '#8BC34A';
            } else if (n√∂v√º === 'bomba') {
                effekt.textContent = '-3 XAL!';
                effekt.style.color = '#FF5722';
            } else if (n√∂v√º === 'meymun') {
                effekt.textContent = 'üõ°Ô∏è Zƒ∞REH! üõ°Ô∏è';
                effekt.style.color = '#7289DA';
            }
            
            effekt.classList.add('klik-effekti');
            
            const rect = canvas.getBoundingClientRect();
            effekt.style.left = (rect.left + x + window.scrollX) + 'px';
            effekt.style.top = (rect.top + y + window.scrollY) + 'px';

            document.body.appendChild(effekt);

            effekt.addEventListener('animationend', () => {
                effekt.remove();
            });
        }

        function barƒ±Yenil…ô() {
            if (!oyunAktiv) return;

            cariBarD…ôy…ôri -= azalmaS√ºr…ôti;

            if (cariBarD…ôy…ôri < 0) {
                cariBarD…ôy…ôri = 0;
            } else if (cariBarD…ôy…ôri > 100) {
                 cariBarD…ôy…ôri = 100;
            }

            saƒülamlƒ±qBarƒ±.style.width = cariBarD…ôy…ôri + '%';
            saƒülamlƒ±qBarƒ±.textContent = `ENERJƒ∞ (${Math.round(cariBarD…ôy…ôri)}%)`;
            
            saƒülamlƒ±qBarƒ±.classList.remove('normal', 'warning', 'critial');
            if (cariBarD…ôy…ôri < 25) {
                saƒülamlƒ±qBarƒ±.classList.add('critial');
            } else if (cariBarD…ôy…ôri < 50) {
                saƒülamlƒ±qBarƒ±.classList.add('warning');
            } else {
                saƒülamlƒ±qBarƒ±.classList.add('normal');
            }

            if (cariBarD…ôy…ôri <= 0) {
                oyunAktiv = false;
                oyunuBitir();
            }
        }
        
        function xalƒ±YaddaSaxla(yekunXal) {
            if (yekunXal === 0) return;

            db.collection("leaderboard").add({
                ad: cariUserName,
                xal: yekunXal, 
                tarix: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                sƒ±ralamanƒ±Y√ºkl…ô();
            })
            .catch((error) => {
                console.error("Xal yazƒ±lark…ôn x…ôta:", error);
            });
        }

        function sƒ±ralamanƒ±Y√ºkl…ô() {
            sƒ±ralamaListi.innerHTML = '<li><span class="sƒ±ra-adƒ±">Y√ºkl…ônir...</span></li>';

            db.collection("leaderboard")
              .orderBy("xal", "desc")
              .limit(10) 
              .get()
              .then((snapshot) => {
                sƒ±ralamaListi.innerHTML = ''; 
                if (snapshot.empty) {
                    sƒ±ralamaListi.innerHTML = '<li>H…ôl…ôlik he√ß bir n…ôtic…ô yoxdur.</li>';
                    return;
                }
                
                let sƒ±ra = 1;
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const li = document.createElement('li');
                    li.innerHTML = `
                      <span>${sƒ±ra}. <span class="sƒ±ra-adƒ±">${data.ad}</span></span> 
                      <span class="sƒ±ra-xalƒ±">${data.xal}</span>
                    `;
                    sƒ±ralamaListi.appendChild(li);
                    sƒ±ra++;
                });
              })
              .catch((error) => {
                sƒ±ralamaListi.innerHTML = `<li><span class="sƒ±ra-adƒ±">X…ôta: M…ôlumat oxunmadƒ±.</span></li>`;
                console.error("Sƒ±ralama x…ôtasƒ±:", error);
              });
        }

        function oyunuBitir() {
            bitdiS…ôsi.play();
            updateBestScore(xal);
            sonXalGosterici.textContent = xal;
            finalBestScoreGosterici.textContent = `∆èn Yax≈üƒ± Yerli Xal: ${getBestScore()}`;
            oyunBitdiMesaj.style.display = 'flex';
            canvas.style.opacity = '0.3';
            t…ôhl√ºk…ôsizlikMesaj.style.display = 'none';
            t…ôhl√ºk…ôsizlikRejimiAktiv = false;
            
            xalƒ±YaddaSaxla(xal); 
        }

        function yenil…ô(cariVaxt) {
            if (!oyunAktiv) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            barƒ±Yenil…ô();

            firlanmaBucaƒüƒ± += firlanmaS√ºr…ôti;

            if (cariVaxt - sonYenil…ônm…ôVaxtƒ± > yenil…ônm…ôAralƒ±ƒüƒ±) {
                obyektYeriYenil…ô();
                sonYenil…ônm…ôVaxtƒ± = cariVaxt;
            }

            obyektl…ôri√á…ôk();

            requestAnimationFrame(yenil…ô);
        }

        canvas.addEventListener('click', function(e) {
            if (!oyunAktiv || !cariObyekt) return;

            const rect = canvas.getBoundingClientRect();
            const klikX = e.clientX - rect.left;
            const klikY = e.clientY - rect.top;

            const tolerantlƒ±q = 5;
            
            if (
                klikX >= cariObyekt.x - tolerantlƒ±q &&
                klikX <= cariObyekt.x + cariObyekt.√∂l√ß√º + tolerantlƒ±q &&
                klikY >= cariObyekt.y - tolerantlƒ±q &&
                klikY <= cariObyekt.y + cariObyekt.√∂l√ß√º + tolerantlƒ±q
            ) {
                if (cariObyekt.n√∂v√º === 'banana') {
                    xal++;
                    cariBarD…ôy…ôri += artƒ±rmaD…ôy…ôri;
                    yaratKlikEffekti(klikX, klikY, 'banana');
                    bananaS…ôsi.currentTime = 0;
                    bananaS…ôsi.play();
                } else if (cariObyekt.n√∂v√º === 'bomba') { 
                    if (t…ôhl√ºk…ôsizlikRejimiAktiv) {
                        yaratKlikEffekti(klikX, klikY, 'bomba'); 
                        bombaS…ôsi.currentTime = 0;
                        bombaS…ôsi.play();
                    } else {
                        xal = Math.max(0, xal - 3); 
                        cariBarD…ôy…ôri -= bombaC…ôzasƒ±; 
                        yaratKlikEffekti(klikX, klikY, 'bomba');
                        bombaS…ôsi.currentTime = 0;
                        bombaS…ôsi.play();
                    }
                } else if (cariObyekt.n√∂v√º === 'meymun') {
                    meymunS…ôsi.currentTime = 0;
                    meymunS…ôsi.play();
                    t…ôhl√ºk…ôsizlikRejiminiAktivl…ô≈üdir();
                    yaratKlikEffekti(klikX, klikY, 'meymun');
                }
                
                xalGosterici.textContent = xal;
                
                obyektYeriYenil…ô();
                sonYenil…ônm…ôVaxtƒ± = performance.now();
                updateBestScore(xal);
                
                if (cariBarD…ôy…ôri > 100) cariBarD…ôy…ôri = 100;
                
            } 
        });

        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault(); 
            if (!oyunAktiv || !cariObyekt) return;

            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const klikX = touch.clientX - rect.left;
            const klikY = touch.clientY - rect.top;

            const tolerantlƒ±q = 15;
            
            if (
                klikX >= cariObyekt.x - tolerantlƒ±q &&
                klikX <= cariObyekt.x + cariObyekt.√∂l√ß√º + tolerantlƒ±q &&
                klikY >= cariObyekt.y - tolerantlƒ±q &&
                klikY <= cariObyekt.y + cariObyekt.√∂l√ß√º + tolerantlƒ±q
            ) {
                if (cariObyekt.n√∂v√º === 'banana') {
                    xal++;
                    cariBarD…ôy…ôri += artƒ±rmaD…ôy…ôri;
                    yaratKlikEffekti(klikX, klikY, 'banana');
                    bananaS…ôsi.currentTime = 0;
                    bananaS…ôsi.play();
                } else if (cariObyekt.n√∂v√º === 'bomba') { 
                    if (t…ôhl√ºk…ôsizlikRejimiAktiv) {
                        yaratKlikEffekti(klikX, klikY, 'bomba');
                        bombaS…ôsi.currentTime = 0;
                        bombaS…ôsi.play();
                    } else {
                        xal = Math.max(0, xal - 3); 
                        cariBarD…ôy…ôri -= bombaC…ôzasƒ±; 
                        yaratKlikEffekti(klikX, klikY, 'bomba');
                        bombaS…ôsi.currentTime = 0;
                        bombaS…ôsi.play();
                    }
                } else if (cariObyekt.n√∂v√º === 'meymun') {
                    meymunS…ôsi.currentTime = 0;
                    meymunS…ôsi.play();
                    t…ôhl√ºk…ôsizlikRejiminiAktivl…ô≈üdir();
                    yaratKlikEffekti(klikX, klikY, 'meymun');
                }
                
                xalGosterici.textContent = xal;
                
                obyektYeriYenil…ô();
                sonYenil…ônm…ôVaxtƒ± = performance.now();
                updateBestScore(xal);

                if (cariBarD…ôy…ôri > 100) cariBarD…ôy…ôri = 100;

            }
        }, { passive: false });

        function oyunuBaslat() {
            const userName = istifad…ô√ßiAdƒ±Input.value.trim() || 'Anonim';
            if (userName.length < 2 || userName.length > 15) {
                alert("Ad minimum 2, maksimum 15 simvol olmalƒ±dƒ±r.");
                return;
            }
            
            cariUserName = userName;
            localStorage.setItem(USER_NAME_KEY, userName);
            
            ba≈ülamaMenyu.style.display = 'none';
            oyunAktiv = true;
            xal = 0;
            cariBarD…ôy…ôri = 100;
            xalGosterici.textContent = xal;
            canvas.style.opacity = '1';
            
            obyektYeriYenil…ô();
            sonYenil…ônm…ôVaxtƒ± = performance.now();
            yenil…ô(performance.now());
        }

        function ilkinY√ºkl…ônm…ô() {
            bestScoreGosterici.textContent = `∆èn y√ºks…ôk skorunuz: ${getBestScore()}`;
            sƒ±ralamanƒ±Y√ºkl…ô(); 
            yenil…ônm…ôAralƒ±ƒüƒ± = isMobile() ? mobilS√ºr…ôt : desktopS√ºr…ôt; 
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }

        ilkinY√ºkl…ônm…ô();

        window.addEventListener('resize', () => {
             canvas.width = canvas.offsetWidth;
             canvas.height = canvas.offsetHeight;
             yenil…ônm…ôAralƒ±ƒüƒ± = isMobile() ? mobilS√ºr…ôt : desktopS√ºr…ôt; 
        });
    </script>
</body>
</html>